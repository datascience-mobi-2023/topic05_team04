```{r}
load("/Users/luisherfurth/Codenmachtspass/prism_datasets.rda")
load("/Users/luisherfurth/Codenmachtspass/cellline_datasets.rda")
```
#### prism_datasets.rda
## Checkt wie viele Zeilen und Spalten NA`s drin haben
```{r}
sum(is.na(prism)) ##432639
sum(apply(prism, 1, function(x){any(is.na(x))})) ##481
sum(apply(prism, 2, function(x){any(is.na(x))})) ##11168
```
--> Macht kein Sinn dies Spalten mit NA`s zu löschen, weil es zu viele sind

## Min und Max Werte
```{r}
min(prism, na.rm = TRUE) ##-12.06536
max(prism, na.rm = TRUE) ##5.007653
length(which(prism == "0")) ## 0 => keine mit genau 0
```

## Entfernen der Spalten mit nur NA`s
```{r}
sum(apply(prism, 2, function(x){all(is.na(x))})) ## 43 Spalten mit nur NA`s
p_onlyNA.col <- colnames(prism[which(sapply(prism, class) == "logical")]) ## Die 43 Spalten mit nur NA`s
rem.pNAcol <- which(colnames(prism) %in% p_onlyNA.col)
sum(is.na(prism[,-rem.pNAcol])) ## 411956
```
--> 411956 NA`s in den restlichen Spalten

## Verteilung der NA`s
```{r}
mean(colMeans(is.na(prism[,-rem.pNAcol]))) #0.07698 => 7.7% NA`s in jeder Spalte
hist(colMeans(is.na(prism[,-rem.pNAcol])), breaks = 100, xlab = "NA Anteil", main = "Histogramm der NA Anteile")
```


## Imputation of the NA`s with the colMeans
```{r}
prismNA <- prism[, -rem.pNAcol]
prism_imp <- as.data.frame(apply(prismNA, 2, function(x) {
    is_na <- is.na(x)
    x[is_na] <- mean(x, na.rm = TRUE)
    return(x)
})) ## --> ersetzen der NA`s mit dem Mittelwert der Spalte

sum(is.na(prism_imp))
```
--> Frage ist wie sinnvoll das ist, eher durch Mittelwert der Spalte ersetzen?

## Versuch es in einer heatmap darzustellen
```{r}
library(pheatmap)
pheatmap(prism_imp, show_rownames = FALSE, show_colnames = FALSE)
```

#### subset breastcancer celllines
## Auswählen des Brustkrebs Datensatzes
```{r}
breast_prism <- prism[which(prism.cl$lineage ==  "breast"), ]
sum(is.na(breast_prism)) ## 26045 NA´s
sum(apply(breast_prism, 2, function(x){any(is.na(x))})) #9673 Spalten mit NA`s
mean(colMeans(is.na(breast_prism))) #0.106 => 10.6% NA`s in jeder Spalte
```
--> NA`s müssen vermutlich ersetzt werden

## Imputation of NA`s durch Mittwert der Spalte
```{r}
bp_onlyNA.col <- colnames(breast_prism[which(colSums(is.na(breast_prism)) == 22)]) 
rem.bpNAcol <- which(colnames(breast_prism) %in% bp_onlyNA.col)
breast_prism_imp <- breast_prism[, -rem.bpNAcol] ## --> entfernen der Spalten mit nur NA`s

breast_prism_imp <- as.data.frame(apply(breast_prism_imp, 2, function(x) {
    is_na <- is.na(x)
    x[is_na] <- mean(x, na.rm = TRUE)
    return(x)
})) ## --> ersetzen der NA`s mit dem Mittelwert der Spalte

sum(is.na(breast_prism_imp)) #0 NA´s => hat funktioniert
```
--> Neuer Dataframe mit ersetzen NA`s durch Mittelwert der Spalte

## Versuch es in einer heatmap darzustellen
```{r}
library(pheatmap)
heatmapbreast <- pheatmap(breast_prism_imp, show_rownames = FALSE, show_colnames = FALSE)
heatmapbreast
```

## Correlation between the drugs (columns) and celllines (rows)
```{r}
### For the drugs (columns)
breast_col_cor <- cor(breast_prism_imp, method = "pearson", use = "pairwise.complete.obs")
pheatmap(breast_col_cor, show_rownames = FALSE, show_colnames = FALSE) ## --> zu groß

### For the celllines (rows)
breast_row_cor <- cor(t(breast_prism_imp), method = "pearson", use = "pairwise.complete.obs")
pheatmap(breast_row_cor, show_rownames = FALSE, show_colnames = FALSE)

### Filter drugs that have a high correlation
breast_col_cor_df <- as.data.frame(breast_col_cor)
high_breast_cor <- which(breast_col_cor_df > 0.9, arr.ind = TRUE) ## Achtung jedes Paar 2x drin (Spalte und Zeile)

## Dopplungen?
length(which(breast_col_cor_df == 1, arr.ind = TRUE)) ## 16654
dim(breast_col_cor_df) ## 11124 x 11124
```
--> Es gibt mehr drugs mit cor = 1, als die auf Diagonalen => Dopplungen oder?

## Dopplungen finden
```{r}
breast_cor_double <- which(breast_col_cor_df == 1 & upper.tri(breast_col_cor_df), arr.ind = TRUE) 
## schaut nur in der oberen Dreiecksmatrix nach Werten = 1 -> Dopplungen
length(breast_cor_double) ## 0 ??? => keine Dopplungen
```
--> Bruv, was ist da los? Warum gibt es keine Dopplungen?